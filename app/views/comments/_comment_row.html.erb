<%= tag.tr id: "comment_#{comment.id}", class: "hover", data: { controller: "collapsible", collapsible_expanded_value: "false" } do %>
  <td class="max-w-xs">
    <div class="flex items-start gap-2">
      <% if comment.replies.any? %>
        <button type="button"
                class="btn btn-ghost btn-xs shrink-0 mt-1"
                data-action="click->collapsible#toggle"
                data-collapsible-target="trigger">
          <span class="iconify lucide--chevron-right size-4 transition-transform" data-collapsible-target="icon"></span>
        </button>
      <% else %>
        <div class="w-6"></div>
      <% end %>
      <div class="line-clamp-3 text-sm" title="<%= comment.text %>">
        <%= comment.text %>
      </div>
    </div>
  </td>
  <td>
    <% if comment.video %>
      <%= link_to video_path(comment.video), class: "link link-hover text-sm line-clamp-1" do %>
        <%= comment.video.title&.truncate(30) || "Untitled" %>
      <% end %>
    <% else %>
      <span class="text-base-content/50 text-sm">-</span>
    <% end %>
  </td>
  <td>
    <div class="flex items-center gap-2">
      <% if comment.google_account %>
        <% if comment.google_account.avatar_url.present? %>
          <%= image_tag comment.google_account.avatar_url, referrer_policy: "no-referrer", class: "w-6 h-6 rounded-full", alt: "" %>
        <% else %>
          <div class="w-6 h-6 rounded-full bg-base-200 flex items-center justify-center">
            <span class="iconify lucide--user size-3.5 text-base-content/50"></span>
          </div>
        <% end %>
        <span class="text-sm"><%= comment.google_account.display_name %></span>
      <% else %>
        <span class="text-base-content/50 text-sm">-</span>
      <% end %>
    </div>
  </td>
  <td class="whitespace-nowrap">
    <% badge_class = case comment.status
                     when "visible" then "badge-success"
                     when "hidden" then "badge-warning"
                     when "removed" then "badge-error"
                     else "badge-ghost"
                     end %>
    <span class="badge badge-sm <%= badge_class %> whitespace-nowrap"><%= comment.status %></span>
  </td>
  <td class="text-center whitespace-nowrap">
    <span class="text-sm"><%= comment.like_count || 0 %></span>
  </td>
  <td class="text-center whitespace-nowrap">
    <% if comment.rank.present? %>
      <span class="badge badge-sm badge-outline whitespace-nowrap">#<%= comment.rank %></span>
    <% else %>
      <span class="text-base-content/40 text-sm">-</span>
    <% end %>
  </td>
  <td class="whitespace-nowrap">
    <span class="text-sm text-base-content/60">
      <%= time_ago_in_words(comment.created_at) %> ago
    </span>
  </td>
  <td>
    <% if comment.youtube_comment_id.present? %>
      <%= link_to "https://www.youtube.com/watch?v=#{comment.video&.youtube_id}&lc=#{comment.youtube_comment_id}",
                  target: "_blank",
                  class: "btn btn-ghost btn-xs",
                  title: "View on YouTube" do %>
        <span class="iconify lucide--external-link size-4"></span>
      <% end %>
    <% end %>
  </td>
<% end %>
<% if comment.replies.any? %>
  <tr data-collapsible-target="content" class="hidden" id="comment_<%= comment.id %>_replies">
    <td colspan="8" class="bg-base-200/50 p-0">
      <div class="pl-12 py-2">
        <table class="table table-sm">
          <thead>
          <tr class="text-xs text-base-content/60">
            <th class="w-1/3">Reply</th>
            <th>Posted As</th>
            <th>Status</th>
            <th class="text-center">Likes</th>
            <th>Posted</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <% comment.replies.ordered.each do |reply| %>
            <tr class="hover">
              <td class="max-w-xs">
                <div class="line-clamp-2 text-sm" title="<%= reply.text %>">
                  <%= reply.text %>
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <% if reply.google_account %>
                    <% if reply.google_account.avatar_url.present? %>
                      <%= image_tag reply.google_account.avatar_url, class: "w-5 h-5 rounded-full", alt: "" %>
                    <% end %>
                    <span class="text-xs"><%= reply.google_account.display_name %></span>
                  <% else %>
                    <span class="text-base-content/50 text-xs">-</span>
                  <% end %>
                </div>
              </td>
              <td class="whitespace-nowrap">
                <% reply_badge_class = case reply.status
                                       when "visible" then "badge-success"
                                       when "hidden" then "badge-warning"
                                       when "removed" then "badge-error"
                                       else "badge-ghost"
                                       end %>
                <span class="badge badge-xs <%= reply_badge_class %> whitespace-nowrap"><%= reply.status %></span>
              </td>
              <td class="text-center whitespace-nowrap">
                <span class="text-xs"><%= reply.like_count || 0 %></span>
              </td>
              <td class="whitespace-nowrap">
                  <span class="text-xs text-base-content/60">
                    <%= time_ago_in_words(reply.created_at) %> ago
                  </span>
              </td>
              <td>
                <% if reply.youtube_comment_id.present? %>
                  <%= link_to "https://www.youtube.com/watch?v=#{reply.video&.youtube_id}&lc=#{reply.youtube_comment_id}",
                              target: "_blank",
                              class: "btn btn-ghost btn-xs",
                              title: "View on YouTube" do %>
                    <span class="iconify lucide--external-link size-3"></span>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </td>
  </tr>
<% end %>